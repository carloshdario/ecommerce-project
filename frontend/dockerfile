# frontend/Dockerfile

# ----------------------------------------------------
# 1. EST츼GIO DE BUILD
# ----------------------------------------------------
FROM node:14-alpine AS build
# 游뚿 AJUSTE 1: Usa a raiz do app como WORKDIR
WORKDIR /app 

# Copia e instala as depend칡ncias para aproveitar o cache
# 游뚿 AJUSTE 2: Copia os arquivos de DEPEND칅NCIA da subpasta 'ecommerce/' para /app/
COPY ecommerce/package.json ecommerce/package-lock.json ./ 
RUN npm install

# Copia o restante do c칩digo fonte e constr칩i o Nuxt
# 游뚿 AJUSTE 3: Copia o restante do c칩digo fonte de 'ecommerce/' para /app/
COPY ecommerce/ . 
RUN npm run build

# ----------------------------------------------------
# 2. EST츼GIO DE EXECU칂츾O (Runtime)
# ----------------------------------------------------
FROM node:14-alpine
WORKDIR /app

# Copia os arquivos essenciais de produ칞칚o do est치gio de build
# 游뚿 AJUSTE 4: Os caminhos de ORIGEM agora s칚o /app/ (raiz do est치gio de build)
COPY --from=build /app/.nuxt/ ./.nuxt/
COPY --from=build /app/node_modules/ ./node_modules/
# Mantido, mas deve existir na sua pasta local (ecommerce/static/):
COPY --from=build /app/static/ ./static/ 
COPY --from=build /app/package.json . 

# Vari치vel de Ambiente para o Nuxt/Axios (lida pelo Nuxt)
ENV API_URL=http://backend:8080/api

EXPOSE 3000
CMD [ "npm", "start" ]
